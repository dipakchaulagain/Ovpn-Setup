{% extends 'base.html' %}

{% block content %}
<div class="flex-header">
    <h1>Users</h1>
    <form action="{{ url_for('apply_rules') }}" method="POST" style="display: inline;">
        <button type="submit" class="btn btn-primary">Apply Rules to System</button>
    </form>
</div>

<div class="card">
    <h2>Add New User</h2>
    <form action="{{ url_for('add_user') }}" method="POST" style="display: flex; gap: 1rem; align-items: flex-end;">
        <div class="form-group" style="flex: 1; margin-bottom: 0;">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" required placeholder="e.g. UserA">
        </div>
        <div class="form-group" style="flex: 1; margin-bottom: 0;">
            <label for="ip_address">IP Address</label>
            <input type="text" id="ip_address" name="ip_address" required placeholder="e.g. 10.8.0.1">
        </div>
        <button type="submit" class="btn btn-primary">Add User</button>
    </form>
</div>

<div class="card">
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>IP Address</th>
                <th>Rules</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.ip_address }}</td>
                <td>{{ user.rules|length }} rules</td>
                <td>
                    <a href="{{ url_for('user_rules', user_id=user.id) }}" class="btn btn-primary btn-sm">Manage
                        Rules</a>
                    <form action="{{ url_for('delete_user', user_id=user.id) }}" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-danger btn-sm"
                            onclick="return confirm('Are you sure?')">Delete</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" style="text-align: center; color: var(--text-light);">No users found. Add one above.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}